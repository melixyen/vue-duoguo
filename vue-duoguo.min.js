!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.VueDuoGuo=factory()}(this,function(){"use strict";var vuePlugInName="Vue-duoguo",CONST_STATE_SUCCESS=1,CONST_STATE_FAIL=0,version="0.1";function assert(condition,message){if(!condition)throw new Error("["+vuePlugInName+"] "+message)}function warn(condition,message){condition||"undefined"!=typeof console&&console.warn("["+vuePlugInName+"] "+message)}function isError(err){return Object.prototype.toString.call(err).indexOf("Error")>-1}function loadScript(file,cbFn){var head=document.getElementsByTagName("head")[0],script=document.createElement("script");script.type="text/javascript",script.onload=script.onreadystatechange=function(){var event={readyState:this.readyState};this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState?(event.status=CONST_STATE_FAIL,cbFn(event)):(event.status=CONST_STATE_SUCCESS,cbFn(event),script.onload=script.onreadystatechange=null)},script.onerror=function(){cbFn({readyState:this.readyState,status:CONST_STATE_FAIL})},script.src=file,head.appendChild(script)}function loadJSON(url,cbFn){function reqListener(xhr){var res=xhr.target.response;try{res=JSON.parse(res)}catch(e){assert(!1,"json file format error.")}var event={xhr:xhr,res:res};4==xhr.target.readyState&&200==xhr.target.status?(event.status=CONST_STATE_SUCCESS,cbFn(JSON.parse(xhr.target.response),event)):(event.status=CONST_STATE_FAIL,cbFn(xhr.target.response,event))}var fm=new XMLHttpRequest;fm.addEventListener("load",reqListener),fm.addEventListener("error",reqListener),fm.addEventListener("abort",reqListener),fm.addEventListener("timeout",reqListener),fm.open("GET",url),fm.timeout=3e4,fm.withCredentials=!0,fm.send()}function pageLoaded(myArgs,cbFn){var me=this;"complete"==document.readyState?cbFn.apply(me,myArgs):window.addEventListener("load",function(){cbFn.apply(me,myArgs)})}var inBrowser="undefined"!=typeof window,VueDuoGuo=function VueDuoGuo(options){void 0===options&&(options={}),this.app=null},_Vue;VueDuoGuo.version="0.1",VueDuoGuo.CONST_STATE_SUCCESS=CONST_STATE_SUCCESS,VueDuoGuo.CONST_STATE_FAIL=CONST_STATE_FAIL;var cmpArray=[],config={},prog={lang:"",mode:"obj",type:"json",loadBase:!1,writeToCmpData:!1},langString;function findCmpIndex(cmp){return cmpArray.findIndex(function(c){return!(c._uid!=cmp._uid)})}function registerCmp(cmp){if(void 0===cmp._uid)return!1;-1==findCmpIndex(cmp)&&cmpArray.push(cmp)}function unregisterCmp(cmp){if(void 0===cmp._uid)return!1;var tmpA=findCmpIndex(cmp);tmpA>-1&&cmpArray.splice(tmpA,1)}function update(){cmpArray.forEach(function(cmp){prog.writeToCmpData&&(cmp[config.component]=langString),cmp.$forceUpdate()})}function cloneObj(objA,objB){return function(){for(var k in objB)objA[k]=objB[k];return objA}()}function systemChangeLang(lang){prog.lang=lang,Vue.duoguo.lang=lang}function change(lang,cbFn){lang||assert(!1,"You must set a language key for Vue.duoguo.change."),systemChangeLang(lang);var path=config.path,me=this,afterFunction=function(event){event=cloneObj(event=event||{},prog),"function"==typeof config.beforeChange&&config.beforeChange.call(me,event,langString),update(),"function"==typeof config.changed&&config.changed.call(me,event,langString),"function"==typeof cbFn&&cbFn.call(me,event,langString)},giveString=function(strObj){strObj=strObj||langString,"string"==typeof config.global?window[config.global]=strObj:config.global=strObj},replaceLang=function(str,lang){return str.replace("{lang}",lang)};if("obj"==prog.mode){if(langString=JSON.parse(JSON.stringify(path[lang])),prog.loadBase){var objBase=path[config.baseLang];for(var k in objBase)langString[k]||(langString[k]=objBase[k])}giveString(langString),afterFunction()}else if("file"==prog.mode){var baseString,workString;switch(prog.type){case"js":prog.loadBase?loadScript(replaceLang(prog.filepath,config.baseLang),function(){baseString=cloneObj({},"string"==typeof config.global?window[config.global]:config.global),loadScript(replaceLang(prog.filepath,lang),function(){for(var k in langString="string"==typeof config.global?window[config.global]:config.global,baseString)langString&&!langString[k]&&(langString[k]=baseString[k]);afterFunction()})}):loadScript(replaceLang(prog.filepath,lang),function(){afterFunction()});break;case"json":prog.loadBase?loadJSON(replaceLang(prog.filepath,config.baseLang),function(jsonA,e){baseString=jsonA,loadJSON(replaceLang(prog.filepath,lang),function(json,e){for(var k in workString=json,baseString)workString[k]||(workString[k]=baseString[k]);giveString(langString=workString),afterFunction(e)})}):loadJSON(replaceLang(prog.filepath,lang),function(json,e){giveString(langString=json),afterFunction(e)})}}prog.localStorage&&localStorage.setItem(prog.localStorage,lang)}function getLanguageString(){return langString||window[config.global]}return Vue.mixin({mounted:function mounted(){this.$forceUpdate&&registerCmp(this)},beforeDestroy:function beforeDestroy(){this.$forceUpdate&&unregisterCmp(this)}}),VueDuoGuo.install=function(Vue,cfg){function duoguoMethod(opt){return this}VueDuoGuo.install.installed||(VueDuoGuo.install.installed=!0,_Vue=Vue,Vue.duoguo={update:update,change:change,config:config,prog:prog,lang:prog.lang,getLanguageString:getLanguageString,setConfig:VueDuoGuo.setConfig},Object.defineProperty(Vue.prototype,"$duoguo",{get:function get(){return duoguoMethod}}))},VueDuoGuo.setConfig=function(cfg){if(!cfg||"object"!=typeof cfg)return assert(!1,"setConfig parameter is undefined or format error. 多國語言設定 setConfig 參數錯誤"),!1;for(var k in cfg)config[k]=cfg[k];if(systemChangeLang(config.lang),config.baseLang&&"string"==typeof config.baseLang&&(prog.loadBase=!0),config.component&&"string"==typeof config.component&&(prog.writeToCmpData=!0),config.localStorage&&"string"==typeof config.localStorage&&(prog.localStorage=config.localStorage),config.path){var mode="object"==typeof config.path?"obj":"file";if(prog.mode=mode,"file"==mode){var tmpFilenameExt=config.filename.split(".").pop();prog.type=/js$/.test(tmpFilenameExt)?"js":"json",config.type&&(config.type,1)&&(prog.type=config.type);var filepath=config.path;if(!filepath||"string"!=typeof filepath)return assert(!1,"Config path is wrong, please check setConfig parameter."),!1;"/"!=filepath.substr(-1)&&(filepath+="/");var filename=config.filename;if(!filename||"string"!=typeof filename||filename.indexOf("{lang}"))return assert(!1,"Config filename is wrong, please check setConfig parameter. Do not forget dynamic replace word {lang}"),!1;prog.filepath=filepath+filename}}if(config.autoload){var tmpLang=config.lang,autoCallback=config.autoCallback&&"function"==typeof config.autoCallback?config.autoCallback:function(){};prog.localStorage&&localStorage.getItem(prog.localStorage)&&(tmpLang=localStorage.getItem(prog.localStorage)),config.global&&change(tmpLang,function(){pageLoaded.call(this,arguments,autoCallback)})}config.global&&"obj"==mode&&("string"==typeof config.global?langString=window[config.global]:"object"==typeof config.global&&(langString=config.global))},VueDuoGuo.helpMe=function(){console.log("This is an multi language mixin for Vue.js 2.x"),console.info({lang:"en",path:"./lang/",filename:"{lang}.min.js",global:"_LANG",readme:"This is a demo config of use javascript .js for language source."}),console.info({lang:"en",path:"./lang",filename:"{lang}.json",global:"_LANG",readme:"This is a demo config of use .json for language source."}),console.info({lang:"en",path:"{An object variable}",global:"_LANG",readme:"This is a demo config of use .json for language source."})},VueDuoGuo.prototype.init=function init(app){var me=this;assert(VueDuoGuo.install.installed,"not installed. Make sure to call `Vue.use(VueDuoGuo)` before creating root instance."),this.apps.push(app),this.app||(this.app=app)},inBrowser&&window.Vue&&window.Vue.use(VueDuoGuo),VueDuoGuo});